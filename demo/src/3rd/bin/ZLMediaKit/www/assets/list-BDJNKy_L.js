import{S as K,T as R}from"./SearchForm--UjJCjOT.js";import{u as W,D as Z,_ as J}from"./index.es-BwxsRDQ3.js";import{_ as Q,u as X,b as p,d as Y,V as tt,o as m,e as y,c as s,f as x,w as n,g as d,h as u,Z as C,U as g,T as et,j as i,k as r,i as at,B as st,a3 as ot}from"./index-CDi9FOh_.js";import{c as nt}from"./channelStore-cN1zKdKX.js";import{P as lt}from"./PlusOutlined-fWUnR1Y5.js";import{D as it}from"./index-C8iFosyF.js";import{_ as ut}from"./index-CJn88hOA.js";import"./index-0U4ReFbg.js";import"./Col-CzT2f1M-.js";import"./debounce-DNYjP2-6.js";import"./index-BOtK7-by.js";import"./index-CmRA3zZV.js";import"./List-BBz1pjPz.js";import"./index-CtcSKe_t.js";const dt={class:"channel-container"},rt={class:"add_btn"},ct={key:0},pt={key:1},mt={key:2},kt={class:"option"},_t={__name:"list",setup(ft){const{SEND_MESSAGE:k}=X(),{GET_CHANNEL_DATA:w}=nt(),_=p([]),h=p([]),D=p({}),M=p(0),E=Y(()=>({total:M.value,current:P.value,pageSize:U.value})),L=e=>{D.value=e,h.value=_.value.filter(t=>{const a=e.taskName?t.taskName.includes(e.taskName):!0,o=e.taskStatus?t.taskStatus==e.taskStatus:!0;return a&&o})},v=()=>{const e={type:"getAlgoTaskList"};i.on(e.type,t=>{if(t.result===0||t.msg){const a=t.data.tasks;_.value=a.filter(o=>o.taskDelete!=1),console.log("🚀 ~ bus.on ~ data.value:",_.value),h.value=[..._.value]}else r.error("请求失败");i.off(e.type)}),k(e)};let b=[];(()=>{const e={type:"getAiModelList"};i.on(e.type,t=>{t.result===0||t.msg?b=t.data.models:r.error("请求失败"),i.off(e.type)}),k(e)})();const B=e=>e.map(a=>{const o=b.find(S=>S.modelId==a);return o?o.modelName:""}).join("，"),{run:z,loading:c,current:P,pageSize:U}=W(v,{formatResult:e=>e.data.results,pagination:{currentKey:"page",pageSizeKey:"results"}}),N=at(),I=async(e=null)=>{await w(),setTimeout(()=>{console.log("🚀 ~ handleEdit ~ id:",e),e!=null?N.push({path:"/task/edit",query:{id:e}}):N.push("/task/edit")},0)},V=e=>{const t={type:"delAlgoTaskInfo",mediaId:e,controlCommand:2};i.on(t.type,a=>{a.result===0||a.msg?(r.success("操作成功"),v()):r.error("请求失败"),c.value=!1,i.off(t.type)}),c.value=!0,k(t)},$=(e,t)=>{const a={type:"algoTaskControl",mediaId:e,controlCommand:t?1:0};i.on(a.type,o=>{o.result===0||o.msg?(r.success("操作成功"),v()):r.error("请求失败"),c.value=!1,i.off(a.type)}),c.value=!0,k(a)},H=(e,t,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",e,t,a),z({results:e.pageSize,page:e==null?void 0:e.current,sortField:a.field,sortOrder:a.order,...t})},q=[{type:"input",key:"taskName",label:"任务编号"},{type:"select",key:"taskStatus",label:"任务状态",list:[{value:"1",label:"运行中"},{value:"0",label:"未运行"}]}],O=[{title:"任务编号",dataIndex:"taskName",key:"taskName",width:180},{title:"视频源",dataIndex:"mediaUrl",key:"mediaUrl",maxWidth:200,ellipsis:!0},{title:"上报地址",dataIndex:"taskPushUrl",key:"taskPushUrl",maxWidth:200,ellipsis:!0},{title:"算法配置信息",dataIndex:"taskAlgos",key:"taskAlgos",width:180},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus",fixed:"right",width:180},{title:"操作",dataIndex:"action",key:"action",fixed:"right"}],A=p({x:"100%",y:document.body.clientHeight-380});return tt(()=>{window.onresize=()=>(()=>{A.value.y=document.body.clientHeight-380})()}),(e,t)=>{const a=st,o=R,S=ut,j=ot,F=Z,G=J;return m(),y("div",dt,[s(K,{searchList:q,data:{taskName:"",taskStatus:null},onChange:L}),x("div",rt,[s(a,{type:"primary",onClick:t[0]||(t[0]=f=>I(null)),style:{padding:"0 15px"}},{default:n(()=>[s(d(lt)),t[2]||(t[2]=u("新建 "))]),_:1})]),s(G,{columns:O,"data-source":d(h),pagination:d(E),loading:d(c),scroll:d(A),onChange:H},{bodyCell:n(({column:f,record:l})=>[f.dataIndex==="taskStatus"?(m(),y("span",ct,[s(o,{color:l.taskStatus?"green":"volcano"},{default:n(()=>[u(C(l.taskStatus?"运行中":"未运行"),1)]),_:2},1032,["color"])])):g("",!0),f.dataIndex==="taskAlgos"?(m(),y("span",pt,C(B(l.taskAlgos)),1)):g("",!0),f.dataIndex==="action"?(m(),y("span",mt,[l.taskStatus?g("",!0):(m(),et(a,{key:0,type:"link",onClick:T=>I(l.mediaId)},{default:n(()=>t[3]||(t[3]=[u("编辑")])),_:2},1032,["onClick"])),s(a,{type:"link",onClick:T=>$(l.mediaId,l.taskStatus)},{default:n(()=>[u(C(l.taskStatus?"关闭":"启动"),1)]),_:2},1032,["onClick"]),s(F,null,{overlay:n(()=>[s(j,null,{default:n(()=>[x("div",kt,[s(S,{title:"是否确定删除该数据?",onConfirm:T=>V(l.mediaId),onCancel:t[1]||(t[1]=()=>{})},{default:n(()=>[s(a,{type:"link"},{default:n(()=>t[4]||(t[4]=[u(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"]),s(a,{type:"link",disabled:""},{default:n(()=>t[5]||(t[5]=[u("配置区域")])),_:1})])]),_:2},1024)]),default:n(()=>[x("a",null,[t[6]||(t[6]=u(" 更多 ")),s(d(it))])]),_:2},1024)])):g("",!0)]),_:1},8,["data-source","pagination","loading","scroll"])])}}},Et=Q(_t,[["__scopeId","data-v-c124610b"]]);export{Et as default};

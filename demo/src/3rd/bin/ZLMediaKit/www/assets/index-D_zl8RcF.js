import{S as G,T as O}from"./SearchForm-CW-aKEMV.js";import{W as H}from"./WForm-Be2nrRga.js";import{_ as L,u as $,a0 as R,a as c,o as I,U as X,w as i,e as z,c as s,f as r,g as f,a1 as U,i as _,j as y,B as W,b as J,X as Q,C as Y,d as B,$ as Z,V as A}from"./index-ZFhHKPxY.js";import{c as M}from"./channelStore-Dfo67YHm.js";import{_ as ee}from"./index-CvCyAwd3.js";import{u as te,_ as oe}from"./index.es-C_kbu2Qc.js";import{P as ae}from"./PlusOutlined-CSdKcCeR.js";import{_ as ne}from"./index-B382VTBM.js";import"./index-1s2OQizq.js";import"./Col-C9jpydrb.js";import"./debounce-BZQqrQHQ.js";import"./index-CWWnDwEB.js";import"./List-Dsenz6Ny.js";import"./index-R7dzPPIl.js";import"./index-Cu5367wT.js";import"./ActionButton-BRf9LzwW.js";const se={class:"footer"},le={__name:"Edit",emits:["success"],setup(F,{expose:b,emit:D}){const{SEND_MESSAGE:C}=$(),{channelData:v}=R(M()),l=c(!1),h=c(""),u=c({}),d=c(!1),E=D,N=()=>{const a={type:"setMediaChannelInfo",...u.value};if(!a.mediaId&&a.mediaId!=0){const t=v.value.find(p=>p.mediaDelete==1);t&&(a.mediaId=t.mediaId)}_.on(a.type,t=>{t.result===0?(y.success("操作成功"),l.value=!1,E("success")):y.error("请求失败"),_.off(a.type),d.value=!1}),d.value=!0,C(a)},w=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],m=a=>{h.value=a?"编辑":"新增",u.value=a||{},l.value=!0,d.value=!1},x=()=>{l.value=!1};return b({showDrawer:m}),(a,t)=>{const p=W,V=ee;return I(),X(V,{open:r(l),"onUpdate:open":t[1]||(t[1]=g=>U(l)?l.value=g:null),title:r(h),width:"520","footer-style":{textAlign:"right"},onClose:x},{footer:i(()=>[z("div",se,[s(p,{type:"primary",onClick:N,loading:r(d)},{default:i(()=>t[2]||(t[2]=[f("确认")])),_:1},8,["loading"]),s(p,{class:"close",onClick:x},{default:i(()=>t[3]||(t[3]=[f("取消")])),_:1})])]),default:i(()=>[s(H,{modelValue:r(u),"onUpdate:modelValue":t[0]||(t[0]=g=>U(u)?u.value=g:null),formList:w,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},ie=L(le,[["__scopeId","data-v-4f437229"]]),re={class:"channel-container"},ue={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},de={key:0},ce={key:1},me={__name:"index",setup(F){const{SEND_MESSAGE:b}=$(),{SET_CHANNEL_DATA:D}=M(),{channelData:C}=R(M()),v=c([]),l=c(0),h=J(()=>({total:l.value,current:N.value,pageSize:w.value})),u=()=>{const o={type:"getMediaChannelList"};_.on(o.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const n=e.data.channels;D(n),console.log(C.value),v.value=C.value.filter(k=>k.mediaDelete==0),l.value=v.value.length}else y.error("请求失败");_.off(o.type)}),b(o)},{run:d,loading:E,current:N,pageSize:w}=te(u,{formatResult:o=>{console.log(o,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let m=null;const x=()=>{m&&clearInterval(m),m=setInterval(()=>{console.log("五秒一次"),d()},5e3)};Q(()=>{x()}),Y(()=>{clearInterval(m)});const a=c(""),t=(o=null)=>{a.value.showDrawer(o)},p=(o,e)=>{if(console.log("🚀 ~ handleDelete ~ mediaStatus:",e),e==2){y.error("通道被使用，请先删除相关任务");return}const n={type:"delMediaChannelInfo",mediaId:o};_.on(n.type,k=>{k.result===0?(y.success("操作成功"),d()):y.error("请求失败"),_.off(n.type)}),b(n)},V=(o,e,n)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",o,e,n),d({results:o.pageSize,page:o==null?void 0:o.current,sortField:n.field,sortOrder:n.order,...e})},g=[{type:"input",key:"keyWord",label:"相机编号"},{type:"select",key:"screenKey",label:"通道状态",list:[{value:"name",label:"分组名称"},{value:"description",label:"描述"}]}],K=[{title:"相机编号",dataIndex:"mediaId",key:"mediaName"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}];return(o,e)=>{const n=W,k=O,P=ne,j=oe;return I(),B("div",re,[s(G,{searchList:g}),z("div",ue,[s(n,{type:"primary",onClick:t,disabled:r(l)>=16},{default:i(()=>[s(r(ae)),e[1]||(e[1]=f("新建 "))]),_:1},8,["disabled"])]),s(j,{columns:K,"data-source":r(v),pagination:r(h),loading:r(E),onChange:V,scroll:{x:!0,y:520}},{bodyCell:i(({column:T,record:S})=>[T.key==="mediaStatus"?(I(),B("span",de,[s(k,{color:S.mediaStatus?"green":"volcano"},{default:i(()=>[f(Z(S.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):A("",!0),T.key==="action"?(I(),B("span",ce,[s(n,{type:"link",onClick:q=>t(S)},{default:i(()=>e[2]||(e[2]=[f("编辑")])),_:2},1032,["onClick"]),s(P,{title:"是否确定删除该数据?",onConfirm:q=>p(S.mediaId,S.mediaStatus),onCancel:e[0]||(e[0]=()=>{})},{default:i(()=>[s(n,{type:"link"},{default:i(()=>e[3]||(e[3]=[f("删除")])),_:1})]),_:2},1032,["onConfirm"])])):A("",!0)]),_:1},8,["data-source","pagination","loading"]),s(ie,{ref_key:"editRef",ref:a,onSuccess:u},null,512)])}}},we=L(me,[["__scopeId","data-v-4e14fc07"]]);export{we as default};

import{S as R,T as W}from"./SearchForm-DaFpT3z_.js";import{u as j,D as F,_ as G}from"./index.es-BFPZ6LQM.js";import{_ as H,u as X,a2 as J,b,d as Q,o as _,e as f,c as s,f as g,w as o,g as p,h as r,a1 as h,X as v,j as i,k as d,i as Y,B as Z,a6 as tt}from"./index-CYQXq1Hw.js";import{c as T}from"./channelStore-Bt12TOzT.js";import{P as et}from"./PlusOutlined-BZuS2wjB.js";import{D as at}from"./index-BsRFuyma.js";import{_ as st}from"./index-5kSmPd7P.js";import"./index-CZglWv9X.js";import"./Col-CgBZr6YF.js";import"./debounce-C1k7YIl0.js";import"./index-BS4Hp4Ns.js";import"./List-dtbjobtR.js";import"./index-BhuQxcmV.js";import"./index-Bq6jBos-.js";import"./ActionButton-Gb4Z9eYp.js";const ot={class:"channel-container"},nt={class:"add_btn"},lt={key:0},it={key:1},rt={key:2},dt={class:"option"},ut={__name:"list",setup(pt){const{SEND_MESSAGE:m}=X();J(T());const{GET_CHANNEL_DATA:D}=T(),x=b([]),N=b(0),w=Q(()=>({total:N.value,current:M.value,pageSize:B.value})),k=()=>{const e={type:"getAlgoTaskList"};i.on(e.type,t=>{if(t.result===0||t.msg){const a=t.data.tasks;x.value=a.filter(n=>n.taskDelete!=1)}else d.error("请求失败");i.off(e.type)}),m(e)};let S=[];(()=>{const e={type:"getAiModelList"};i.on(e.type,t=>{t.result===0||t.msg?S=t.data.models:d.error("请求失败"),i.off(e.type)}),m(e)})();const E=e=>e.map(a=>{const n=S.find(y=>y.modelId==a);return n?n.modelName:""}).join("，"),{run:L,loading:u,current:M,pageSize:B}=j(k,{formatResult:e=>e.data.results,pagination:{currentKey:"page",pageSizeKey:"results"}}),C=Y(),I=async(e=null)=>{await D(),setTimeout(()=>{console.log("🚀 ~ handleEdit ~ id:",e),e!=null?C.push({path:"/task/edit",query:{id:e}}):C.push("/task/edit")},0)},P=e=>{const t={type:"delAlgoTaskInfo",mediaId:e,controlCommand:2};i.on(t.type,a=>{a.result===0||a.msg?(d.success("操作成功"),k()):d.error("请求失败"),u.value=!1,i.off(t.type)}),u.value=!0,m(t)},z=(e,t)=>{const a={type:"algoTaskControl",mediaId:e,controlCommand:t?1:0};i.on(a.type,n=>{n.result===0||n.msg?(d.success("操作成功"),k()):d.error("请求失败"),u.value=!1,i.off(a.type)}),u.value=!0,m(a)},U=(e,t,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",e,t,a),L({results:e.pageSize,page:e==null?void 0:e.current,sortField:a.field,sortOrder:a.order,...t})},V=[{type:"input",key:"keyWord",label:"任务编号"},{type:"select",key:"screenKey",label:"任务状态",list:[{value:"name",label:"分组名称"},{value:"description",label:"描述"}]}],$=[{title:"任务编号",dataIndex:"taskName",key:"taskName",width:180},{title:"视频源",dataIndex:"mediaUrl",key:"mediaUrl",maxWidth:200,ellipsis:!0},{title:"上报地址",dataIndex:"taskPushUrl",key:"taskPushUrl",maxWidth:200,ellipsis:!0},{title:"算法配置信息",dataIndex:"taskAlgos",key:"taskAlgos",width:180},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus",fixed:"right",width:180},{title:"操作",dataIndex:"action",key:"action",fixed:"right"}];return(e,t)=>{const a=Z,n=W,y=st,q=tt,K=F,O=G;return _(),f("div",ot,[s(R,{searchList:V}),g("div",nt,[s(a,{type:"primary",onClick:t[0]||(t[0]=c=>I(null)),style:{padding:"0 15px"}},{default:o(()=>[s(p(et)),t[2]||(t[2]=r("新建 "))]),_:1})]),s(O,{columns:$,"data-source":p(x),pagination:p(w),loading:p(u),scroll:{x:!0,y:560},onChange:U},{bodyCell:o(({column:c,record:l})=>[c.dataIndex==="taskStatus"?(_(),f("span",lt,[s(n,{color:l.taskStatus?"green":"volcano"},{default:o(()=>[r(h(l.taskStatus?"运行中":"未运行"),1)]),_:2},1032,["color"])])):v("",!0),c.dataIndex==="taskAlgos"?(_(),f("span",it,h(E(l.taskAlgos)),1)):v("",!0),c.dataIndex==="action"?(_(),f("span",rt,[s(a,{type:"link",onClick:A=>I(l.mediaId)},{default:o(()=>t[3]||(t[3]=[r("编辑")])),_:2},1032,["onClick"]),s(a,{type:"link",onClick:A=>z(l.mediaId,l.taskStatus)},{default:o(()=>[r(h(l.taskStatus?"关闭":"启动"),1)]),_:2},1032,["onClick"]),s(K,null,{overlay:o(()=>[s(q,null,{default:o(()=>[g("div",dt,[s(y,{title:"是否确定删除该数据?",onConfirm:A=>P(l.mediaId),onCancel:t[1]||(t[1]=()=>{})},{default:o(()=>[s(a,{type:"link"},{default:o(()=>t[4]||(t[4]=[r(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"]),s(a,{type:"link",disabled:""},{default:o(()=>t[5]||(t[5]=[r("配置区域")])),_:1})])]),_:2},1024)]),default:o(()=>[g("a",null,[t[6]||(t[6]=r(" 更多 ")),s(p(at))])]),_:2},1024)])):v("",!0)]),_:1},8,["data-source","pagination","loading"])])}}},Dt=H(ut,[["__scopeId","data-v-5357631f"]]);export{Dt as default};

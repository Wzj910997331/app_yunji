import{S as O,T as Z}from"./SearchForm-CSBbbiMC.js";import{W as J}from"./WForm-DIasoZiv.js";import{_ as L,u as q,$ as z,b as d,o as E,T as Q,w as l,f as H,c as n,g as r,h as y,a0 as $,j as g,k as v,B as W,d as X,V as A,D as Y,e as M,Z as ee,U as F}from"./index-C75yrSxv.js";import{c as R}from"./channelStore-jj-xI2-r.js";import{_ as te}from"./index-CrwAtV-J.js";import{u as ae,_ as oe}from"./index.es--CQYwhSW.js";import{P as ne}from"./PlusOutlined-_k0VOsVA.js";import{_ as se}from"./index-D9NDyqdd.js";import"./index-BUFb_l2c.js";import"./Col-DTkjBlJL.js";import"./debounce-CN_rIKSS.js";import"./index-C_MRxJ4F.js";import"./List-bYv9SaMX.js";import"./index-lYwMDmlm.js";import"./index-BujYrMaM.js";import"./index-CeCNycme.js";const le={class:"footer"},re={__name:"Edit",emits:["success"],setup(K,{expose:x,emit:N}){const{SEND_MESSAGE:I}=q(),{channelData:b}=z(R()),s=d(!1),D=d(""),i=d({}),c=d(!1),T=N,p=d(""),U=async()=>{if(!await p.value.validate())return;const t={type:"setMediaChannelInfo",...i.value};if(!t.mediaId&&t.mediaId!=0){const u=b.value.find(S=>S.mediaDelete==1);u&&(t.mediaId=u.mediaId)}g.on(t.type,u=>{u.result===0?(v.success("操作成功"),s.value=!1,T("success")):v.error("请求失败"),g.off(t.type),c.value=!1}),c.value=!0,I(t)},f=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],V=m=>{p.value&&p.value.resetForm(),D.value=m?"编辑":"新增",i.value=m||{},s.value=!0,c.value=!1},k=()=>{s.value=!1},w={mediaUrl:[{required:!0,message:"请输入",trigger:"blur"}],mediaName:[{required:!0,message:"请输入",trigger:"blur"}],mediaDesc:[{required:!0,message:"请输入",trigger:"blur"}]};return x({showDrawer:V}),(m,t)=>{const u=W,S=te;return E(),Q(S,{open:r(s),"onUpdate:open":t[1]||(t[1]=_=>$(s)?s.value=_:null),title:r(D),width:"520","footer-style":{textAlign:"right"},onClose:k},{footer:l(()=>[H("div",le,[n(u,{type:"primary",onClick:U,loading:r(c)},{default:l(()=>t[2]||(t[2]=[y("确认")])),_:1},8,["loading"]),n(u,{class:"close",onClick:k},{default:l(()=>t[3]||(t[3]=[y("取消")])),_:1})])]),default:l(()=>[n(J,{ref_key:"wFormRef",ref:p,modelValue:r(i),"onUpdate:modelValue":t[0]||(t[0]=_=>$(i)?i.value=_:null),formList:f,rules:w,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},ie=L(re,[["__scopeId","data-v-ba6fd5cf"]]),ue={class:"channel-container"},de={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},ce={key:0},me={key:1},pe={__name:"index",setup(K){const{SEND_MESSAGE:x}=q(),{SET_CHANNEL_DATA:N}=R(),{channelData:I}=z(R()),b=d([]),s=d(0),D=X(()=>({total:s.value,current:p.value,pageSize:U.value})),i=()=>{const a={type:"getMediaChannelList"};g.on(a.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const o=e.data.channels;N(o),console.log(I.value),b.value=I.value.filter(h=>h.mediaDelete==0),s.value=b.value.length}else v.error("请求失败");g.off(a.type)}),x(a)},{run:c,loading:T,current:p,pageSize:U}=ae(i,{formatResult:a=>{console.log(a,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let f=null;const V=()=>{f&&clearInterval(f),f=setInterval(()=>{console.log("五秒一次"),i()},5e3)};A(()=>{V()}),Y(()=>{clearInterval(f)});const k=d(""),w=(a=null)=>{k.value.showDrawer(a)},m=(a,e)=>{if(console.log("🚀 ~ handleDelete ~ mediaStatus:",e),e==2){v.error("通道被使用，请先删除相关任务");return}const o={type:"delMediaChannelInfo",mediaId:a};g.on(o.type,h=>{h.result===0?(v.success("操作成功"),c()):v.error("请求失败"),g.off(o.type)}),x(o)},t=(a,e,o)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",a,e,o),c({results:a.pageSize,page:a==null?void 0:a.current,sortField:o.field,sortOrder:o.order,...e})},u=[{type:"input",key:"keyWord",label:"相机编号"},{type:"select",key:"screenKey",label:"通道状态",list:[{value:"name",label:"分组名称"},{value:"description",label:"描述"}]}],S=[{title:"相机编号",dataIndex:"mediaId",key:"mediaName"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}],_=d({x:"100%",y:document.body.clientHeight-380});return A(()=>{window.onresize=()=>(()=>{_.value.y=document.body.clientHeight-380})()}),(a,e)=>{const o=W,h=Z,P=se,j=oe;return E(),M("div",ue,[n(O,{searchList:u}),H("div",de,[n(o,{type:"primary",onClick:e[0]||(e[0]=B=>w(null)),disabled:r(s)>=16},{default:l(()=>[n(r(ne)),e[2]||(e[2]=y("新建 "))]),_:1},8,["disabled"])]),n(j,{columns:S,"data-source":r(b),pagination:r(D),loading:r(T),onChange:t,scroll:r(_)},{bodyCell:l(({column:B,record:C})=>[B.key==="mediaStatus"?(E(),M("span",ce,[n(h,{color:C.mediaStatus?"green":"volcano"},{default:l(()=>[y(ee(C.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):F("",!0),B.key==="action"?(E(),M("span",me,[n(o,{type:"link",onClick:G=>w(C)},{default:l(()=>e[3]||(e[3]=[y("编辑")])),_:2},1032,["onClick"]),n(P,{title:"是否确定删除该数据?",onConfirm:G=>m(C.mediaId,C.mediaStatus),onCancel:e[1]||(e[1]=()=>{})},{default:l(()=>[n(o,{type:"link"},{default:l(()=>e[4]||(e[4]=[y("删除")])),_:1})]),_:2},1032,["onConfirm"])])):F("",!0)]),_:1},8,["data-source","pagination","loading","scroll"]),n(ie,{ref_key:"editRef",ref:k,onSuccess:i},null,512)])}}},Te=L(pe,[["__scopeId","data-v-bf33ac05"]]);export{Te as default};

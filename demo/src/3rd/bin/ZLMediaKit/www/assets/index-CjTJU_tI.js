import{S as J,T as Z}from"./SearchForm-D0tZeR4v.js";import{W as Q}from"./WForm-Dtn8C-SB.js";import{_ as O,u as H,$ as W,b as d,o as I,T as X,w as r,f as j,c as n,g as u,h as _,a0 as L,j as g,k as y,B as K,d as Y,r as ee,V as q,D as te,e as $,Z as ae,U as z}from"./index-CXUYW_Aq.js";import{c as A}from"./channelStore-CGhHBszt.js";import{_ as oe}from"./index-B5AZwG97.js";import{u as ne,_ as se}from"./index.es-BVG1eBNY.js";import{P as le}from"./PlusOutlined-BGUR3X44.js";import{_ as ie}from"./index-DxQ4jxO5.js";import"./index-h6m4oyuo.js";import"./Col-ikAy_vAU.js";import"./debounce-bMGHWjko.js";import"./index-DJHYksiB.js";import"./List-BYQobCE7.js";import"./index-CmfL3-cj.js";import"./index-BgjfWSWb.js";import"./index-nkfBG120.js";const re={class:"footer"},ue={__name:"Edit",emits:["success"],setup(P,{expose:C,emit:w}){const{SEND_MESSAGE:E}=H(),{channelData:v}=W(A()),i=d(!1),N=d(""),s=d({}),m=d(!1),S=w,p=d(""),T=async()=>{if(!await p.value.validate())return;const o={type:"setMediaChannelInfo",...s.value};if(!o.mediaId&&o.mediaId!=0){const l=v.value.find(b=>b.mediaDelete==1);l&&(o.mediaId=l.mediaId)}g.on(o.type,l=>{l.result===0?(y.success(l.msg),i.value=!1,S("success")):y.error(l.msg),g.off(o.type),m.value=!1}),m.value=!0,E(o)},U=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],V=c=>{p.value&&p.value.resetForm(),N.value=c?"编辑":"新增",s.value=c||{},i.value=!0,m.value=!1},x=()=>{i.value=!1},D={mediaUrl:[{required:!0,message:"请输入",trigger:"blur"}],mediaName:[{required:!0,message:"请输入",trigger:"blur"}],mediaDesc:[{required:!0,message:"请输入",trigger:"blur"}]};return C({showDrawer:V}),(c,o)=>{const l=K,b=oe;return I(),X(b,{open:u(i),"onUpdate:open":o[1]||(o[1]=k=>L(i)?i.value=k:null),title:u(N),width:"520","footer-style":{textAlign:"right"},onClose:x},{footer:r(()=>[j("div",re,[n(l,{type:"primary",onClick:T,loading:u(m)},{default:r(()=>o[2]||(o[2]=[_("确认")])),_:1},8,["loading"]),n(l,{class:"close",onClick:x},{default:r(()=>o[3]||(o[3]=[_("取消")])),_:1})])]),default:r(()=>[n(Q,{ref_key:"wFormRef",ref:p,modelValue:u(s),"onUpdate:modelValue":o[0]||(o[0]=k=>L(s)?s.value=k:null),formList:U,rules:D,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},de=O(ue,[["__scopeId","data-v-2f4e0f14"]]),me={class:"channel-container"},ce={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},pe={key:0},fe={key:1},_e={__name:"index",setup(P){const{SEND_MESSAGE:C}=H(),{SET_CHANNEL_DATA:w}=A(),{channelData:E}=W(A()),v=d([]),i=d(0),N=Y(()=>({total:i.value,current:U.value,pageSize:V.value})),s=ee({mediaName:"",mediaStatus:""}),m=d(!1),S=()=>{const t={type:"getMediaChannelList"};g.on(t.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const a=e.data.channels;w(a),p()}else y.error(e.msg);m.value=!1,g.off(t.type)}),m.value=!0,C(t)},p=(t=null)=>{t&&Object.assign(s,t);const e=E.value.filter(a=>a.mediaDelete==0);v.value=e.filter(a=>{const f=String(a.mediaName),B=s.mediaName?f.includes(s.mediaName):!0,M=s.mediaStatus?s.mediaStatus==1?a.mediaStatus>0:a.mediaStatus==0:!0;return B&&M}),i.value=v.value.length},{run:T,current:U,pageSize:V}=ne(S,{formatResult:t=>{console.log(t,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let x=null;q(()=>{}),te(()=>{clearInterval(x)});const D=d(""),c=(t=null)=>{t&&(t=JSON.parse(JSON.stringify(t))),D.value.showDrawer(t)},o=(t,e)=>{if(console.log("🚀 ~ handleDelete ~ mediaStatus:",e),e==2){y.error("通道被使用，请先删除相关任务");return}const a={type:"delMediaChannelInfo",mediaId:t};g.on(a.type,f=>{f.result===0?(y.success(f.msg),S()):y.error(f.msg),g.off(a.type)}),C(a)},l=(t,e,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",t,e,a),T({results:t.pageSize,page:t==null?void 0:t.current,sortField:a.field,sortOrder:a.order,...e})},b=[{type:"input",key:"mediaName",label:"相机编号"},{type:"select",key:"mediaStatus",label:"通道状态",list:[{value:"1",label:"正常"},{value:"0",label:"异常"}]}],k=[{title:"相机编号",dataIndex:"mediaName",key:"mediaName"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}],F=d({x:"100%",y:document.body.clientHeight-380});return q(()=>{window.onresize=()=>(()=>{F.value.y=document.body.clientHeight-380})()}),(t,e)=>{const a=K,f=Z,B=ie,M=se;return I(),$("div",me,[n(J,{searchList:b,data:{mediaName:"",mediaStatus:null},onChange:p}),j("div",ce,[n(a,{type:"primary",onClick:e[0]||(e[0]=R=>c(null)),disabled:u(i)>=16},{default:r(()=>[n(u(le)),e[2]||(e[2]=_("新建 "))]),_:1},8,["disabled"])]),n(M,{columns:k,"data-source":u(v),pagination:u(N),loading:u(m),onChange:l,scroll:u(F)},{bodyCell:r(({column:R,record:h})=>[R.key==="mediaStatus"?(I(),$("span",pe,[n(f,{color:h.mediaStatus?"green":"volcano"},{default:r(()=>[_(ae(h.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):z("",!0),R.key==="action"?(I(),$("span",fe,[n(a,{type:"link",onClick:G=>c(h)},{default:r(()=>e[3]||(e[3]=[_("编辑")])),_:2},1032,["onClick"]),n(B,{title:"是否确定删除该数据?",onConfirm:G=>o(h.mediaId,h.mediaStatus),onCancel:e[1]||(e[1]=()=>{})},{default:r(()=>[n(a,{type:"link"},{default:r(()=>e[4]||(e[4]=[_("删除")])),_:1})]),_:2},1032,["onConfirm"])])):z("",!0)]),_:1},8,["data-source","pagination","loading","scroll"]),n(de,{ref_key:"editRef",ref:D,onSuccess:S},null,512)])}}},Ve=O(_e,[["__scopeId","data-v-7fafd085"]]);export{Ve as default};

import{S as G,T as O}from"./SearchForm-CbKrYdj9.js";import{W as H}from"./WForm-CS5wZDt4.js";import{_ as U,u as R,a2 as W,b as c,o as I,W as X,w as i,f as $,c as s,g as r,h as f,a3 as A,j as _,k as y,B as z,d as Z,Z as J,E as Q,e as M,a1 as Y,X as L}from"./index-aNIfo854.js";import{c as T}from"./channelStore-CckJZugj.js";import{_ as ee}from"./index-DJiAbVaV.js";import{u as te,_ as oe}from"./index.es-DX6mIkRE.js";import{P as ae}from"./PlusOutlined-B7gLAiVd.js";import{_ as ne}from"./index-BGzNgi0h.js";import"./index-XsA9DfIQ.js";import"./Col-B8w7Ubqz.js";import"./debounce-DJi5mwmY.js";import"./index-D_uLXcOy.js";import"./List-DoRPfoeT.js";import"./index-BYU4Xr3M.js";import"./index-eE3Tj_Ig.js";import"./index-B6yYNcnT.js";import"./ActionButton-k2dsG7sK.js";const se={class:"footer"},le={__name:"Edit",emits:["success"],setup(F,{expose:b,emit:D}){const{SEND_MESSAGE:h}=R(),{channelData:v}=W(T()),l=c(!1),C=c(""),u=c({}),d=c(!1),E=D,N=()=>{const a={type:"setMediaChannelInfo",...u.value};if(!a.mediaId&&a.mediaId!=0){const t=v.value.find(p=>p.mediaDelete==1);t&&(a.mediaId=t.mediaId)}_.on(a.type,t=>{t.result===0?(y.success("操作成功"),l.value=!1,E("success")):y.error("请求失败"),_.off(a.type),d.value=!1}),d.value=!0,h(a)},w=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],m=a=>{C.value=a?"编辑":"新增",u.value=a||{},l.value=!0,d.value=!1},x=()=>{l.value=!1};return b({showDrawer:m}),(a,t)=>{const p=z,B=ee;return I(),X(B,{open:r(l),"onUpdate:open":t[1]||(t[1]=g=>A(l)?l.value=g:null),title:r(C),width:"520","footer-style":{textAlign:"right"},onClose:x},{footer:i(()=>[$("div",se,[s(p,{type:"primary",onClick:N,loading:r(d)},{default:i(()=>t[2]||(t[2]=[f("确认")])),_:1},8,["loading"]),s(p,{class:"close",onClick:x},{default:i(()=>t[3]||(t[3]=[f("取消")])),_:1})])]),default:i(()=>[s(H,{modelValue:r(u),"onUpdate:modelValue":t[0]||(t[0]=g=>A(u)?u.value=g:null),formList:w,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},ie=U(le,[["__scopeId","data-v-4f437229"]]),re={class:"channel-container"},ue={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},de={key:0},ce={key:1},me={__name:"index",setup(F){const{SEND_MESSAGE:b}=R(),{SET_CHANNEL_DATA:D}=T(),{channelData:h}=W(T()),v=c([]),l=c(0),C=Z(()=>({total:l.value,current:N.value,pageSize:w.value})),u=()=>{const o={type:"getMediaChannelList"};_.on(o.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const n=e.data.channels;D(n),console.log(h.value),v.value=h.value.filter(k=>k.mediaDelete==0),l.value=v.value.length}else y.error("请求失败");_.off(o.type)}),b(o)},{run:d,loading:E,current:N,pageSize:w}=te(u,{formatResult:o=>{console.log(o,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let m=null;const x=()=>{m&&clearInterval(m),m=setInterval(()=>{console.log("五秒一次"),d()},5e3)};J(()=>{x()}),Q(()=>{clearInterval(m)});const a=c(""),t=(o=null)=>{a.value.showDrawer(o)},p=(o,e)=>{if(console.log("🚀 ~ handleDelete ~ mediaStatus:",e),e==2){y.error("通道被使用，请先删除相关任务");return}const n={type:"delMediaChannelInfo",mediaId:o};_.on(n.type,k=>{k.result===0?(y.success("操作成功"),d()):y.error("请求失败"),_.off(n.type)}),b(n)},B=(o,e,n)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",o,e,n),d({results:o.pageSize,page:o==null?void 0:o.current,sortField:n.field,sortOrder:n.order,...e})},g=[{type:"input",key:"keyWord",label:"相机编号"},{type:"select",key:"screenKey",label:"通道状态",list:[{value:"name",label:"分组名称"},{value:"description",label:"描述"}]}],K=[{title:"相机编号",dataIndex:"mediaId",key:"mediaName"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}];return(o,e)=>{const n=z,k=O,P=ne,j=oe;return I(),M("div",re,[s(G,{searchList:g}),$("div",ue,[s(n,{type:"primary",onClick:t,disabled:r(l)>=16},{default:i(()=>[s(r(ae)),e[1]||(e[1]=f("新建 "))]),_:1},8,["disabled"])]),s(j,{columns:K,"data-source":r(v),pagination:r(C),loading:r(E),onChange:B,scroll:{x:!0,y:520}},{bodyCell:i(({column:V,record:S})=>[V.key==="mediaStatus"?(I(),M("span",de,[s(k,{color:S.mediaStatus?"green":"volcano"},{default:i(()=>[f(Y(S.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):L("",!0),V.key==="action"?(I(),M("span",ce,[s(n,{type:"link",onClick:q=>t(S)},{default:i(()=>e[2]||(e[2]=[f("编辑")])),_:2},1032,["onClick"]),s(P,{title:"是否确定删除该数据?",onConfirm:q=>p(S.mediaId,S.mediaStatus),onCancel:e[0]||(e[0]=()=>{})},{default:i(()=>[s(n,{type:"link"},{default:i(()=>e[3]||(e[3]=[f("删除")])),_:1})]),_:2},1032,["onConfirm"])])):L("",!0)]),_:1},8,["data-source","pagination","loading"]),s(ie,{ref_key:"editRef",ref:a,onSuccess:u},null,512)])}}},Be=U(me,[["__scopeId","data-v-4e14fc07"]]);export{Be as default};

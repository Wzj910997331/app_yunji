import{S as Z,T as J}from"./SearchForm--UjJCjOT.js";import{W as Q}from"./WForm-BVYTya9x.js";import{_ as H,u as W,$ as j,b as u,o as w,T as X,w as r,f as K,c as n,g as d,h as f,a0 as L,j as _,k as g,B as O,d as Y,r as ee,V as q,D as te,e as $,Z as ae,U as z}from"./index-CDi9FOh_.js";import{c as A}from"./channelStore-cN1zKdKX.js";import{_ as oe}from"./index-p0iKhbEA.js";import{u as ne,_ as se}from"./index.es-BwxsRDQ3.js";import{P as le}from"./PlusOutlined-fWUnR1Y5.js";import{_ as ie}from"./index-CJn88hOA.js";import"./index-0U4ReFbg.js";import"./Col-CzT2f1M-.js";import"./debounce-DNYjP2-6.js";import"./index-C8iFosyF.js";import"./List-BBz1pjPz.js";import"./index-BOtK7-by.js";import"./index-CmRA3zZV.js";import"./index-CtcSKe_t.js";const re={class:"footer"},de={__name:"Edit",emits:["success"],setup(P,{expose:h,emit:E}){const{SEND_MESSAGE:N}=W(),{channelData:y}=j(A()),l=u(!1),I=u(""),s=u({}),c=u(!1),C=E,p=u(""),T=async()=>{if(!await p.value.validate())return;const o={type:"setMediaChannelInfo",...s.value};if(!o.mediaId&&o.mediaId!=0){const i=y.value.find(v=>v.mediaDelete==1);i&&(o.mediaId=i.mediaId)}_.on(o.type,i=>{i.result===0?(g.success("操作成功"),l.value=!1,C("success")):g.error(i.msg),_.off(o.type),c.value=!1}),c.value=!0,N(o)},U=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],V=m=>{p.value&&p.value.resetForm(),I.value=m?"编辑":"新增",s.value=m||{},l.value=!0,c.value=!1},x=()=>{l.value=!1},D={mediaUrl:[{required:!0,message:"请输入",trigger:"blur"}],mediaName:[{required:!0,message:"请输入",trigger:"blur"}],mediaDesc:[{required:!0,message:"请输入",trigger:"blur"}]};return h({showDrawer:V}),(m,o)=>{const i=O,v=oe;return w(),X(v,{open:d(l),"onUpdate:open":o[1]||(o[1]=S=>L(l)?l.value=S:null),title:d(I),width:"520","footer-style":{textAlign:"right"},onClose:x},{footer:r(()=>[K("div",re,[n(i,{type:"primary",onClick:T,loading:d(c)},{default:r(()=>o[2]||(o[2]=[f("确认")])),_:1},8,["loading"]),n(i,{class:"close",onClick:x},{default:r(()=>o[3]||(o[3]=[f("取消")])),_:1})])]),default:r(()=>[n(Q,{ref_key:"wFormRef",ref:p,modelValue:d(s),"onUpdate:modelValue":o[0]||(o[0]=S=>L(s)?s.value=S:null),formList:U,rules:D,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},ue=H(de,[["__scopeId","data-v-8e2a6041"]]),me={class:"channel-container"},ce={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},pe={key:0},fe={key:1},_e={__name:"index",setup(P){const{SEND_MESSAGE:h}=W(),{SET_CHANNEL_DATA:E}=A(),{channelData:N}=j(A()),y=u([]),l=u(0),I=Y(()=>({total:l.value,current:U.value,pageSize:V.value})),s=ee({mediaId:"",mediaStatus:""}),c=()=>{const t={type:"getMediaChannelList"};_.on(t.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const a=e.data.channels;E(a),C()}else g.error(e.msg);_.off(t.type)}),h(t)},C=(t=null)=>{t&&Object.assign(s,t);const e=N.value.filter(a=>a.mediaDelete==0);y.value=e.filter(a=>{const b=String(a.mediaId),B=s.mediaId?b.includes(s.mediaId):!0,M=s.mediaStatus?String(a.mediaStatus)===s.mediaStatus:!0;return B&&M}),l.value=y.value.length},{run:p,loading:T,current:U,pageSize:V}=ne(c,{formatResult:t=>{console.log(t,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let x=null;q(()=>{}),te(()=>{clearInterval(x)});const D=u(""),m=(t=null)=>{D.value.showDrawer(t)},o=(t,e)=>{if(console.log("🚀 ~ handleDelete ~ mediaStatus:",e),e==2){g.error("通道被使用，请先删除相关任务");return}const a={type:"delMediaChannelInfo",mediaId:t};_.on(a.type,b=>{b.result===0?(g.success("操作成功"),p()):g.error("请求失败"),_.off(a.type)}),h(a)},i=(t,e,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",t,e,a),p({results:t.pageSize,page:t==null?void 0:t.current,sortField:a.field,sortOrder:a.order,...e})},v=[{type:"input",key:"mediaId",label:"相机编号"},{type:"select",key:"mediaStatus",label:"通道状态",list:[{value:"1",label:"正常"},{value:"0",label:"异常"}]}],S=[{title:"相机编号",dataIndex:"mediaId",key:"mediaId"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}],F=u({x:"100%",y:document.body.clientHeight-380});return q(()=>{window.onresize=()=>(()=>{F.value.y=document.body.clientHeight-380})()}),(t,e)=>{const a=O,b=J,B=ie,M=se;return w(),$("div",me,[n(Z,{searchList:v,data:{mediaId:"",mediaStatus:null},onChange:C}),K("div",ce,[n(a,{type:"primary",onClick:e[0]||(e[0]=R=>m(null)),disabled:d(l)>=16},{default:r(()=>[n(d(le)),e[2]||(e[2]=f("新建 "))]),_:1},8,["disabled"])]),n(M,{columns:S,"data-source":d(y),pagination:d(I),loading:d(T),onChange:i,scroll:d(F)},{bodyCell:r(({column:R,record:k})=>[R.key==="mediaStatus"?(w(),$("span",pe,[n(b,{color:k.mediaStatus?"green":"volcano"},{default:r(()=>[f(ae(k.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):z("",!0),R.key==="action"?(w(),$("span",fe,[n(a,{type:"link",onClick:G=>m(k)},{default:r(()=>e[3]||(e[3]=[f("编辑")])),_:2},1032,["onClick"]),n(B,{title:"是否确定删除该数据?",onConfirm:G=>o(k.mediaId,k.mediaStatus),onCancel:e[1]||(e[1]=()=>{})},{default:r(()=>[n(a,{type:"link"},{default:r(()=>e[4]||(e[4]=[f("删除")])),_:1})]),_:2},1032,["onConfirm"])])):z("",!0)]),_:1},8,["data-source","pagination","loading","scroll"]),n(ue,{ref_key:"editRef",ref:D,onSuccess:c},null,512)])}}},Ve=H(_e,[["__scopeId","data-v-b1bdb291"]]);export{Ve as default};

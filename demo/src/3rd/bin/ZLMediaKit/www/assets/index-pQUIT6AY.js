import{S as G,T as O}from"./SearchForm-Br2hd-4i.js";import{W as H}from"./WForm-H3eFhFQR.js";import{_ as A,u as L,a0 as R,a as c,o as x,U as X,w as i,e as z,c as n,f as r,g as f,a1 as U,i as _,j as g,B as W,b as J,X as Q,C as Y,d as B,$ as Z,V as $}from"./index-hI_BHtZ1.js";import{c as M}from"./channelStore-CmX89MHa.js";import{_ as ee}from"./index-BPaJAf0x.js";import{u as te,_ as ae}from"./index.es-9CUF-kWl.js";import{P as oe}from"./PlusOutlined-LVlNiO5e.js";import{_ as ne}from"./index-CPi-pUHj.js";import"./index-BkLvWLkG.js";import"./Col-eL2dFxCZ.js";import"./index-Bws9bqCi.js";import"./index-Dx0R36r9.js";import"./ActionButton-DS8mWbS_.js";const se={class:"footer"},le={__name:"Edit",emits:["success"],setup(F,{expose:k,emit:I}){const{SEND_MESSAGE:S}=L(),{channelData:y}=R(M()),l=c(!1),b=c(""),u=c({}),d=c(!1),D=I,E=()=>{const o={type:"setMediaChannelInfo",...u.value};if(!o.mediaId&&o.mediaId!=0){const t=y.value.find(p=>p.mediaDelete==1);t&&(o.mediaId=t.mediaId)}_.on(o.type,t=>{t.result===0?(g.success("操作成功"),l.value=!1,D("success")):g.error("请求失败"),_.off(o.type),d.value=!1}),d.value=!0,S(o)},N=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],m=o=>{b.value=o?"编辑":"新增",u.value=o||{},l.value=!0,d.value=!1},C=()=>{l.value=!1};return k({showDrawer:m}),(o,t)=>{const p=W,w=ee;return x(),X(w,{open:r(l),"onUpdate:open":t[1]||(t[1]=v=>U(l)?l.value=v:null),title:r(b),width:"520","footer-style":{textAlign:"right"},onClose:C},{footer:i(()=>[z("div",se,[n(p,{type:"primary",onClick:E,loading:r(d)},{default:i(()=>t[2]||(t[2]=[f("确认")])),_:1},8,["loading"]),n(p,{class:"close",onClick:C},{default:i(()=>t[3]||(t[3]=[f("取消")])),_:1})])]),default:i(()=>[n(H,{modelValue:r(u),"onUpdate:modelValue":t[0]||(t[0]=v=>U(u)?u.value=v:null),formList:N,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},ie=A(le,[["__scopeId","data-v-4f437229"]]),re={class:"channel-container"},ue={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},de={key:0},ce={key:1},me={__name:"index",setup(F){const{SEND_MESSAGE:k}=L(),{SET_CHANNEL_DATA:I}=M(),{channelData:S}=R(M()),y=c([]),l=c(0),b=J(()=>({total:l.value,current:E.value,pageSize:N.value})),u=()=>{const a={type:"getMediaChannelList"};_.on(a.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const s=e.data.channels;I(s),console.log(S.value),y.value=S.value.filter(V=>V.mediaDelete==0),l.value=y.value.length}else g.error("请求失败");_.off(a.type)}),k(a)},{run:d,loading:D,current:E,pageSize:N}=te(u,{formatResult:a=>{console.log(a,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let m=null;const C=()=>{m&&clearInterval(m),m=setInterval(()=>{console.log("五秒一次"),d()},5e3)};Q(()=>{C()}),Y(()=>{clearInterval(m)});const o=c(""),t=(a=null)=>{o.value.showDrawer(a)},p=a=>{const e={type:"delMediaChannelInfo",mediaId:a};_.on(e.type,s=>{s.result===0?(g.success("操作成功"),d()):g.error("请求失败"),_.off(e.type)}),k(e)},w=(a,e,s)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",a,e,s),d({results:a.pageSize,page:a==null?void 0:a.current,sortField:s.field,sortOrder:s.order,...e})},v=[{type:"input",key:"keyWord",label:"相机编号"},{type:"select",key:"screenKey",label:"通道状态",list:[{value:"name",label:"分组名称"},{value:"description",label:"描述"}]}],K=[{title:"相机编号",dataIndex:"mediaId",key:"mediaName"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}];return(a,e)=>{const s=W,V=O,P=ne,j=ae;return x(),B("div",re,[n(G,{searchList:v}),z("div",ue,[n(s,{type:"primary",onClick:t,disabled:r(l)>=16},{default:i(()=>[n(r(oe)),e[1]||(e[1]=f("新建 "))]),_:1},8,["disabled"])]),n(j,{columns:K,"data-source":r(y),pagination:r(b),loading:r(D),onChange:w,scroll:{x:!0,y:520}},{bodyCell:i(({column:T,record:h})=>[T.key==="mediaStatus"?(x(),B("span",de,[n(V,{color:h.mediaStatus?"green":"volcano"},{default:i(()=>[f(Z(h.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):$("",!0),T.key==="action"?(x(),B("span",ce,[n(s,{type:"link",onClick:q=>t(h)},{default:i(()=>e[2]||(e[2]=[f("编辑")])),_:2},1032,["onClick"]),n(P,{title:"是否确定删除该数据?",onConfirm:q=>p(h.mediaId),onCancel:e[0]||(e[0]=()=>{})},{default:i(()=>[n(s,{type:"link"},{default:i(()=>e[3]||(e[3]=[f("删除")])),_:1})]),_:2},1032,["onConfirm"])])):$("",!0)]),_:1},8,["data-source","pagination","loading"]),n(ie,{ref_key:"editRef",ref:o,onSuccess:u},null,512)])}}},De=A(me,[["__scopeId","data-v-a74016c1"]]);export{De as default};

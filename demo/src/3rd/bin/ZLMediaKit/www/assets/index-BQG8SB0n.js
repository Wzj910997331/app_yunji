import{S as Z,T as J}from"./SearchForm-BKyQ_HQc.js";import{W as Q}from"./WForm-N4Mosagg.js";import{_ as H,u as W,$ as j,b as d,o as w,T as X,w as r,f as K,c as n,g as u,h as f,a0 as L,j as _,k as y,B as O,d as Y,r as ee,V as q,D as te,e as $,Z as ae,U as z}from"./index-0WvK6C2i.js";import{c as A}from"./channelStore-DRH7tsLD.js";import{_ as oe}from"./index-BacwxZLG.js";import{u as ne,_ as se}from"./index.es-CdcllolZ.js";import{P as le}from"./PlusOutlined-CHyHp1Jv.js";import{_ as ie}from"./index-PB38sW9W.js";import"./index-usPi87uD.js";import"./Col-QspOhJ19.js";import"./debounce-cOzjl19W.js";import"./index-sQ36ty4v.js";import"./List-CzR7Ze3u.js";import"./index-CDWfSvXp.js";import"./index-CqLsB6dj.js";import"./index-CQYqznZm.js";const re={class:"footer"},ue={__name:"Edit",emits:["success"],setup(P,{expose:h,emit:E}){const{SEND_MESSAGE:T}=W(),{channelData:g}=j(A()),l=d(!1),C=d(""),s=d({}),p=d(!1),N=E,c=d(""),x=async()=>{if(!await c.value.validate())return;const o={type:"setMediaChannelInfo",...s.value};if(!o.mediaId&&o.mediaId!=0){const i=g.value.find(v=>v.mediaDelete==1);i&&(o.mediaId=i.mediaId)}_.on(o.type,i=>{i.result===0?(y.success("操作成功"),l.value=!1,N("success")):y.error(i.msg),_.off(o.type),p.value=!1}),p.value=!0,T(o)},U=[{type:"input",label:"视频地址",key:"mediaUrl"},{type:"input",label:"相机编号",key:"mediaName"},{type:"textarea",label:"相机描述",key:"mediaDesc"}],V=m=>{c.value&&c.value.resetForm(),C.value=m?"编辑":"新增",s.value=m||{},l.value=!0,p.value=!1},D=()=>{l.value=!1},I={mediaUrl:[{required:!0,message:"请输入",trigger:"blur"}],mediaName:[{required:!0,message:"请输入",trigger:"blur"}],mediaDesc:[{required:!0,message:"请输入",trigger:"blur"}]};return h({showDrawer:V}),(m,o)=>{const i=O,v=oe;return w(),X(v,{open:u(l),"onUpdate:open":o[1]||(o[1]=S=>L(l)?l.value=S:null),title:u(C),width:"520","footer-style":{textAlign:"right"},onClose:D},{footer:r(()=>[K("div",re,[n(i,{type:"primary",onClick:x,loading:u(p)},{default:r(()=>o[2]||(o[2]=[f("确认")])),_:1},8,["loading"]),n(i,{class:"close",onClick:D},{default:r(()=>o[3]||(o[3]=[f("取消")])),_:1})])]),default:r(()=>[n(Q,{ref_key:"wFormRef",ref:c,modelValue:u(s),"onUpdate:modelValue":o[0]||(o[0]=S=>L(s)?s.value=S:null),formList:U,rules:I,labelWidth:"100px"},null,8,["modelValue"])]),_:1},8,["open","title"])}}},de=H(ue,[["__scopeId","data-v-8e2a6041"]]),me={class:"channel-container"},ce={style:{display:"flex","justify-content":"end","margin-bottom":"20px"}},pe={key:0},fe={key:1},_e={__name:"index",setup(P){const{SEND_MESSAGE:h}=W(),{SET_CHANNEL_DATA:E}=A(),{channelData:T}=j(A()),g=d([]),l=d(0),C=Y(()=>({total:l.value,current:U.value,pageSize:V.value})),s=ee({mediaName:"",mediaStatus:""}),p=d(!1),N=()=>{const t={type:"getMediaChannelList"};_.on(t.type,e=>{if(e.result===0){console.log("🚀 ~ bus.on ~ res:",e);const a=e.data.channels;E(a),c()}else y.error(e.msg);_.off(t.type)}),h(t)},c=(t=null)=>{t&&Object.assign(s,t);const e=T.value.filter(a=>a.mediaDelete==0);g.value=e.filter(a=>{const b=String(a.mediaName),B=s.mediaName?b.includes(s.mediaName):!0,M=s.mediaStatus?s.mediaStatus==1?a.mediaStatus>0:a.mediaStatus==0:!0;return B&&M}),l.value=g.value.length},{run:x,current:U,pageSize:V}=ne(N,{formatResult:t=>{console.log(t,"run==========")},pagination:{currentKey:"page",pageSizeKey:"results"}});let D=null;q(()=>{}),te(()=>{clearInterval(D)});const I=d(""),m=(t=null)=>{I.value.showDrawer(t)},o=(t,e)=>{if(console.log("🚀 ~ handleDelete ~ mediaStatus:",e),e==2){y.error("通道被使用，请先删除相关任务");return}const a={type:"delMediaChannelInfo",mediaId:t};_.on(a.type,b=>{b.result===0?(y.success("操作成功"),x()):y.error("请求失败"),_.off(a.type)}),h(a)},i=(t,e,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",t,e,a),x({results:t.pageSize,page:t==null?void 0:t.current,sortField:a.field,sortOrder:a.order,...e})},v=[{type:"input",key:"mediaName",label:"相机编号"},{type:"select",key:"mediaStatus",label:"通道状态",list:[{value:"1",label:"正常"},{value:"0",label:"异常"}]}],S=[{title:"相机编号",dataIndex:"mediaName",key:"mediaName"},{title:"视频地址",dataIndex:"mediaUrl",key:"mediaUrl"},{title:"通道状态",key:"mediaStatus",dataIndex:"mediaStatus"},{title:"操作",key:"action"}],F=d({x:"100%",y:document.body.clientHeight-380});return q(()=>{window.onresize=()=>(()=>{F.value.y=document.body.clientHeight-380})()}),(t,e)=>{const a=O,b=J,B=ie,M=se;return w(),$("div",me,[n(Z,{searchList:v,data:{mediaName:"",mediaStatus:null},onChange:c}),K("div",ce,[n(a,{type:"primary",onClick:e[0]||(e[0]=R=>m(null)),disabled:u(l)>=16},{default:r(()=>[n(u(le)),e[2]||(e[2]=f("新建 "))]),_:1},8,["disabled"])]),n(M,{columns:S,"data-source":u(g),pagination:u(C),loading:u(p),onChange:i,scroll:u(F)},{bodyCell:r(({column:R,record:k})=>[R.key==="mediaStatus"?(w(),$("span",pe,[n(b,{color:k.mediaStatus?"green":"volcano"},{default:r(()=>[f(ae(k.mediaStatus?"正常":"异常"),1)]),_:2},1032,["color"])])):z("",!0),R.key==="action"?(w(),$("span",fe,[n(a,{type:"link",onClick:G=>m(k)},{default:r(()=>e[3]||(e[3]=[f("编辑")])),_:2},1032,["onClick"]),n(B,{title:"是否确定删除该数据?",onConfirm:G=>o(k.mediaId,k.mediaStatus),onCancel:e[1]||(e[1]=()=>{})},{default:r(()=>[n(a,{type:"link"},{default:r(()=>e[4]||(e[4]=[f("删除")])),_:1})]),_:2},1032,["onConfirm"])])):z("",!0)]),_:1},8,["data-source","pagination","loading","scroll"]),n(de,{ref_key:"editRef",ref:I,onSuccess:N},null,512)])}}},Ve=H(_e,[["__scopeId","data-v-41cf2aa4"]]);export{Ve as default};

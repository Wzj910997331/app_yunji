import{_ as se,a as g,b as w,X as $e,r as Me,a0 as Se,o as y,U as Ye,w as _,c as v,f as p,a1 as te,e as r,d as k,F as N,Y as E,a$ as K,T as R,$ as O,aX as Xe,aY as Ne,g as I,B as ne,V as Ee}from"./index-BDp3QOIY.js";import{W as Le}from"./WForm-DuZVnybr.js";import{M as De}from"./index-DpZEsOOp.js";import{_ as je,a as Ae}from"./index-CnLrzIUi.js";import{u as Re,_ as Oe}from"./index.es-B-zVPHwP.js";import{P as Be}from"./PlusOutlined-BL7A-Ewd.js";import{_ as ze}from"./index-Ni5QLA6c.js";import"./index-UOzwUsgt.js";import"./Col-WS0i9O_0.js";import"./index-Ctd8tvvV.js";import"./ActionButton-Bho_34Da.js";const Ve={style:{width:"100%"}},Je={class:"time"},qe={class:"timeright"},Fe={class:"timeright_cell"},Ke={class:"timeright_cell",style:{color:"#333333"}},Ue={class:"time"},We={style:{width:"8.8%"}},He=["onClick"],Ge={class:"objects_content"},Pe=["day_index","time_index","object_id"],Qe={class:"box"},Ze={class:"box-btn"},et={class:"dtime"},tt={class:"dts"},st={__name:"AddTemplate",props:{datatype:{type:Number,default:1},objectClassName:{type:String,default:"select_object"},objectIdName:{type:String,default:"object_id"},bgColor:{type:String,default:"#197afb"},useCtrlSelect:{type:Boolean,default:!1},week:{type:Array,default:[]}},emits:["update:week"],setup($,{expose:L,emit:B}){const z=["星期一","星期二","星期三","星期四","星期五","星期六","星期日"],M=g({}),C=g(!1),V=t=>{console.log(t),C.value=!1};L({handleOpen:async t=>{C.value=!0;const e=await be(t);ae(e)}});const S=g(0),D=g(0),b=$;function J(t){if(t.length===0)return[];let e=[],n=t[0],s=t[0];for(let a=1;a<t.length;a++)t[a]===s+1||(e.push({startTime:n,endTime:s}),n=t[a]),s=t[a];return e.push({startTime:n,endTime:s}),e}const q=t=>{let e="",n=t.map(a=>a.id),s=J(n);return(s==null?void 0:s.length)>0&&s.forEach(a=>{let o=t.find(i=>a.startTime==i.id),l=t.find(i=>a.endTime==i.id);if(console.log("end",l),a.startTime==a.endTime){let i=`${m(o.timenum-1)} : ${o.id%2==0?"30":"00"} `,h="";l.id%2!=0?h=`${m(l.timenum-1)} : 30`:h=`${m(l.timenum)} : 00`,e+=`${i} ~ ${h}`}else{let i="",h=`${m(o.timenum-1)} : ${o.id%2==0?"30":"00"} `;a.endTime%2==0?i=`${m(l.timenum)} : 00`:i=`${m(l.timenum-1)} : 30`,e+=`${h} ~ ${i}`}}),e},m=t=>t<10?`0${t}`:t,f=t=>{switch(t){case 1:return"一";case 2:return"二";case 3:return"三";case 4:return"四";case 5:return"五";case 6:return"六";case 7:return"日"}},x=g([]);w(()=>JSON.stringify(x));const F=t=>{let e=[],n=[];u.value.filter(a=>a.status==!0).reduce((a,o)=>a.find(l=>l.daynum==o.daynum)?a:[...a,o],[]);let s=u.value.filter(a=>a.daynum==t);for(let a=0;a<s.length;a++){let o=s[a];o.status==!1?n.length>0&&(e.push(new Array(...n)),n.length=0):n.push(o)}return n.length>0&&(e.push(new Array(...n)),n.length=0),e},c=g([]);let Y=1;const u=g([]);$e(()=>{for(let t=0;t<7;t++)for(let e=0,n=1;e<48;e+=2)u.value.push({id:Y++,status:!1,daynum:t+1,timenum:n}),u.value.push({id:Y++,status:!1,daynum:t+1,timenum:n}),n=n%24+1});const ae=t=>{let e=t===void 0?[]:t;console.log("🚀 ~ datahandle ~ data:",e),e.forEach(n=>{u.value.forEach(s=>{s.id===n.id&&(s.status=!0)})})},le=w(()=>t=>u.value&&u.value.length>0?u.value.filter(e=>e.daynum===t+1).every(e=>e.status===!0):!1),oe=w(()=>t=>u.value&&u.value.length>0?u.value.filter(e=>e.timenum===t+1).every(e=>e.status===!0):!1),T=g(),W=g(),j=B,ie=Me({maskPosition:{show:!1,startX:0,startY:0,endX:0,endY:0},isPressCtrlKey:!1}),{maskPosition:d,isPressCtrlKey:H}=Se(ie);b.useCtrlSelect&&(document.addEventListener("keyup",t=>{t.keyCode===17&&(H.value=!1)}),document.addEventListener("keydown",t=>{t.keyCode===17&&(H.value=!0)}));const ue=t=>{const e=u.value.filter(s=>s.daynum==t+1);e.every(s=>s.status===!0)?e.forEach(s=>{s.status=!1,c.value.splice(c.value.findIndex(a=>a==s.id),1)}):e.forEach(s=>{s.status=!0,c.value.push(s.id)}),j("update:week",A())},re=t=>{const e=u.value.filter(s=>s.timenum==t+1);e.every(s=>s.status===!0)?e.forEach(s=>{s.status=!1,c.value.splice(c.value.findIndex(a=>a==s.id),1)}):e.forEach(s=>{s.status=!0,c.value.push(s.id)}),j("update:week",A())},de=t=>{c.value.length=0;var e=Number(t.target.getAttribute(b.objectIdName));const n=u.value.findIndex(s=>s.id==e);n>-1&&(u.value[n].status=!u.value[n].status),c.value.includes(e)?c.value.splice(c.value.findIndex(s=>s==e),1):c.value.push(e),d.value.show=!0,d.value.startX=t.clientX,d.value.startY=t.clientY,d.value.endX=t.clientX,d.value.endY=t.clientY,T.value.addEventListener("mousemove",G),T.value.addEventListener("mouseup",P)},G=t=>{if(S.value!==t.clientX||D.value!==t.clientY){S.value=t.clientX,D.value=t.clientY,d.value.endX=t.clientX,d.value.endY=t.clientY;const n=T.value.querySelectorAll(`.${b.objectClassName}`),s=W.value.getClientRects()[0];var e=[];n.forEach(o=>{const l=o.getClientRects()[0];if(ce(l,s)){let i=o.getAttribute(b.objectIdName);e.push(Number(i))}});let a=o=>{const l=u.value.findIndex(i=>i.id==o);l>-1&&(u.value[l].status=!u.value[l].status)};for(let o=c.value.length-1;o>=0;o--){const l=c.value[o];e.includes(l)||(a(l),c.value.splice(o,1))}for(const o of e)c.value.includes(o)||(a(o),c.value.push(o))}},P=()=>{T.value.removeEventListener("mousemove",G),T.value.removeEventListener("mouseup",P),d.value.show=!1,me(),j("update:week",A())},A=()=>{let t=u.value;if(x.value.push(Date.now()+""),b.datatype==1){let e=[];for(let n=0;n<t.length;n++)t[n].status?e.push(1):e.push(0);return e.join("")}if(b.datatype==2){let e={};for(let n=0;n<t.length;n++){const s=t[n];s.status&&(e[s.daynum]?e[s.daynum].push(n):e[s.daynum]=[n])}for(let n in e)Array.isArray(e[n])&&(e[n]=e[n].join(","));return JSON.stringify(e)}if(b.datatype==3){let e=[];for(let n=0;n<t.length;n++){const s=t[n];if(s.status){let a=String(s.daynum),o=s.timenum<10?"0"+s.timenum:String(s.timenum),l;n%2===0?l=a+o+"00":l=a+o+"30",e.push(l)}}return e.toString()}},ce=(t,e)=>{const n=Math.max(t.x+t.width,e.x+e.width),s=Math.max(t.y+t.height,e.y+e.height),a=Math.min(t.x,e.x),o=Math.min(t.y,e.y);return n-a<=t.width+e.width&&s-o<=t.height+e.height},me=()=>{d.value.startX=0,d.value.startY=0,d.value.endX=0,d.value.endY=0},fe=w(()=>`${Math.abs(d.value.endX-d.value.startX)}px;`),pe=w(()=>`${Math.abs(d.value.endY-d.value.startY)}px;`),ve=w(()=>`${Math.min(d.value.startX,d.value.endX)}px;`),he=w(()=>`${Math.min(d.value.startY,d.value.endY)}px;`),ye=()=>{u.value.forEach(t=>{t.status=!1}),j("update:week",A())},_e={星期一:1,星期二:2,星期三:3,星期四:4,星期五:5,星期六:6,星期日:7},ge=(t,e)=>{const[n,s]=e.split(":").map(Number);console.log("🚀 ~ timeToIndex ~ hours:",n),console.log(`Hours: ${n}, Minutes: ${s}`,s>30);const a=n+1,o=(t-1)*48+n*2+1;return console.log(`Computed Index: ${a}`),{timenum:a,id:o}},Q=t=>{const[e,n]=t.split(":").map(Number);return e*60+n},ke=(t,e)=>{const n=Q(t),a=Q(e)-n;return Math.floor(a/30)},be=t=>{const e=[];return t.forEach(n=>{const[s,a]=n.split(": "),o=_e[s];a.split(", ").forEach(l=>{const[i,h]=l.split(" ~ "),{timenum:Z,id:ee}=ge(o,i),Ce=ke(i,h);for(let X=0;X<Ce;X++)if(X===0)e.push({daynum:o,timenum:Z,id:ee});else{const Te=Z+X,Ie=ee+X;e.push({daynum:o,timenum:Te,id:Ie})}})}),e},xe=[{type:"input",label:"计划名称",key:"name"}],we={name:[{required:!0,message:"请输入",trigger:"blur"}]};return(t,e)=>{const n=je,s=Ae,a=ne,o=De;return y(),Ye(o,{open:p(C),"onUpdate:open":e[1]||(e[1]=l=>te(C)?C.value=l:null),width:"50%",title:"新建工作计划",onOk:V},{default:_(()=>[v(Le,{modelValue:p(M),"onUpdate:modelValue":e[0]||(e[0]=l=>te(M)?M.value=l:null),formList:xe,rules:we,labelWidth:"80px"},null,8,["modelValue"]),r("div",Ve,[r("div",Je,[e[4]||(e[4]=r("div",{class:"timeleft"},"星期/时间",-1)),r("div",qe,[r("div",Fe,[v(s,{gutter:0},{default:_(()=>[v(n,{span:12},{default:_(()=>e[2]||(e[2]=[r("div",{class:"topitem",style:{"font-size":"12px","font-weight":"bold"}}," 00:00~12:00 ",-1)])),_:1}),v(n,{span:12},{default:_(()=>e[3]||(e[3]=[r("div",{class:"topitem",style:{"font-size":"12px","font-weight":"bold"}}," 12:00~24:00 ",-1)])),_:1})]),_:1})]),r("div",Ke,[v(s,{gutter:0},{default:_(()=>[(y(),k(N,null,E(24,(l,i)=>v(n,{span:1,key:l,onClick:h=>re(i)},{default:_(()=>[r("div",{class:K(["topitem",{is_selected:p(oe)(i)}]),style:R({"--bgColor":$.bgColor})},O(i),7)]),_:2},1032,["onClick"])),64))]),_:1})])])]),r("div",Ue,[r("div",We,[(y(),k(N,null,E(z,(l,i)=>r("div",{class:K(["timelefts",{is_selected:p(le)(i)}]),style:R({"--bgColor":$.bgColor}),key:l,onClick:h=>ue(i)},O(l),15,He)),64))]),r("div",{class:"objects",ref_key:"objectsRef",ref:T,onMousedown:de},[Xe(r("div",{class:"mask",ref_key:"maskRef",ref:W,style:R("width:"+p(fe)+"left:"+p(ve)+"height:"+p(pe)+"top:"+p(he))},null,4),[[Ne,p(d).show]]),r("div",Ge,[(y(!0),k(N,null,E(p(u),l=>(y(),k("div",{key:l.id,class:K(["select_object",{is_selected:l.status}]),day_index:l.daynum,time_index:l.timenum,object_id:l.id,style:R({"--bgColor":$.bgColor})},null,14,Pe))),128))])],544)]),r("div",Qe,[r("div",Ze,[e[6]||(e[6]=r("div",{class:"dt-box"},[r("div",{class:"dt-bg"}),I(" 选中 "),r("div",{class:"dt-bo"}),I(" 未选中 ")],-1)),v(a,{type:"link",onClick:ye},{default:_(()=>e[5]||(e[5]=[I("清空选择")])),_:1})]),r("div",et,[(y(!0),k(N,null,E(p(u).filter(l=>l.status==!0).reduce((l,i)=>l.find(h=>h.daynum==i.daynum)?l:[...l,i],[]),l=>(y(),k("ul",null,[I(" 星期"+O(f(l.daynum))+": ",1),(y(!0),k(N,null,E(F(l.daynum),i=>(y(),k("span",tt,O(q(i)),1))),256))]))),256))])])])]),_:1},8,["open"])}}},nt=se(st,[["__scopeId","data-v-0766b04b"]]),at={class:"planTemplate-container"},lt={class:"header-tool"},ot={key:0},it={__name:"index",setup($){const L=["星期一: 00:00 ~ 10:30","星期五: 09:00 ~ 09:30"],B=m=>{},{run:z,loading:M,current:C,pageSize:V}=Re(B,{formatResult:m=>m.data.results,pagination:{currentKey:"page",pageSizeKey:"results"}}),U=w(()=>({total:200,current:C.value,pageSize:V.value})),S=g(""),D=()=>{S.value.handleOpen(L)},b=(m,f,x)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",m,f,x),z({results:m.pageSize,page:m==null?void 0:m.current,sortField:x.field,sortOrder:x.order,...f})},J=[{title:"模板标识",dataIndex:"name",key:"name"},{title:"工作计划",dataIndex:"age",key:"age"},{title:"操作",key:"action"}],q=[{key:"1",name:"John Brown",age:"/data/bm-app/00013100000213402000000131002024-5-22-1.mp4",address:"New York No. 1 Lake Park",tags:1},{key:"2",name:"Jim Green",age:"/data/bm-app/00013100000213402000000131002024-5-22-1.mp4",address:"London No. 1 Lake Park",tags:1},{key:"3",name:"Joe Black",age:32,address:"Sidney No. 1 Lake Park",tags:0}];return(m,f)=>{const x=ne,F=ze,c=Oe;return y(),k("div",at,[r("div",lt,[v(x,{type:"primary",onClick:f[0]||(f[0]=Y=>D())},{default:_(()=>[v(p(Be)),f[3]||(f[3]=I("新建模板 "))]),_:1})]),v(c,{columns:J,"data-source":q,pagination:p(U),loading:p(M),onChange:b,scroll:{x:!0,y:460}},{bodyCell:_(({column:Y,record:u})=>[Y.key==="action"?(y(),k("span",ot,[v(F,{title:"是否确定删除该数据?",onConfirm:f[1]||(f[1]=()=>{}),onCancel:f[2]||(f[2]=()=>{})},{default:_(()=>[v(x,{type:"link"},{default:_(()=>f[4]||(f[4]=[I("删除")])),_:1})]),_:1})])):Ee("",!0)]),_:1},8,["pagination","loading"]),v(nt,{ref_key:"addTemplateRef",ref:S,week:L},null,512)])}}},gt=se(it,[["__scopeId","data-v-8ab75f51"]]);export{gt as default};

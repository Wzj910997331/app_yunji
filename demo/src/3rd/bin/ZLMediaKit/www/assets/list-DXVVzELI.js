import{S as K,T as R}from"./SearchForm-fFmZQFLM.js";import{u as W,D as Z,_ as J}from"./index.es-Z2FFgI8p.js";import{_ as Q,u as X,b as r,d as Y,V as tt,o as p,e as g,c as o,f as x,w as n,g as m,h as d,Z as C,U as y,T as et,j as i,k as c,i as at,B as st,a3 as ot}from"./index-BvjWryS2.js";import{c as nt}from"./channelStore-Dslrivyn.js";import{P as lt}from"./PlusOutlined-hZcxnXsn.js";import{D as it}from"./index-CLBl60Qf.js";import{_ as ut}from"./index-B4ookOAl.js";import"./index-Bgn2GKDE.js";import"./Col-DGIuxiBu.js";import"./debounce-BKGNfoRD.js";import"./index-CjjNimhK.js";import"./index-C_RoA65C.js";import"./List-BorunFM5.js";import"./index-DSyo-FdW.js";const dt={class:"channel-container"},rt={class:"add_btn"},mt={key:0},ct={key:1},pt={key:2},kt={class:"option"},_t={__name:"list",setup(ft){const{SEND_MESSAGE:k}=X(),{GET_CHANNEL_DATA:w}=nt(),_=r([]),h=r([]),D=r({}),M=r(0),E=Y(()=>({total:M.value,current:P.value,pageSize:U.value})),u=r(!1),L=e=>{D.value=e,h.value=_.value.filter(t=>{const a=e.taskName?t.taskName.includes(e.taskName):!0,s=e.taskStatus?t.taskStatus==e.taskStatus:!0;return a&&s})},v=()=>{const e={type:"getAlgoTaskList"};i.on(e.type,t=>{if(t.result===0||t.msg){const a=t.data.tasks;_.value=a.filter(s=>s.taskDelete!=1),console.log("🚀 ~ bus.on ~ data.value:",_.value),h.value=[..._.value]}else c.error(t.msg);u.value=!1,i.off(e.type)}),u.value=!0,k(e)};let b=[];(()=>{const e={type:"getAiModelList"};i.on(e.type,t=>{t.result===0||t.msg?b=t.data.models:c.error(t.msg),i.off(e.type)}),k(e)})();const B=e=>e.map(a=>{const s=b.find(S=>S.modelId==a);return s?s.modelName:""}).join("，"),{run:z,current:P,pageSize:U}=W(v,{formatResult:e=>e.data.results,pagination:{currentKey:"page",pageSizeKey:"results"}}),N=at(),I=async(e=null)=>{await w(),setTimeout(()=>{console.log("🚀 ~ handleEdit ~ id:",e),e!=null?N.push({path:"/task/edit",query:{id:e}}):N.push("/task/edit")},0)},V=e=>{const t={type:"delAlgoTaskInfo",mediaId:e,controlCommand:2};i.on(t.type,a=>{a.result===0||a.msg?(c.success(a.msg),v()):c.error(a.msg),u.value=!1,i.off(t.type)}),u.value=!0,k(t)},$=(e,t)=>{const a={type:"algoTaskControl",mediaId:e,controlCommand:t?1:0};i.on(a.type,s=>{s.result===0||s.msg?(c.success(s.msg),v()):c.error(s.msg),u.value=!1,i.off(a.type)}),u.value=!0,k(a)},H=(e,t,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",e,t,a),z({results:e.pageSize,page:e==null?void 0:e.current,sortField:a.field,sortOrder:a.order,...t})},q=[{type:"input",key:"taskName",label:"任务编号"},{type:"select",key:"taskStatus",label:"任务状态",list:[{value:"1",label:"运行中"},{value:"0",label:"未运行"}]}],O=[{title:"任务编号",dataIndex:"taskName",key:"taskName",width:180},{title:"视频源",dataIndex:"mediaUrl",key:"mediaUrl",maxWidth:200,ellipsis:!0},{title:"上报地址",dataIndex:"taskPushUrl",key:"taskPushUrl",maxWidth:200,ellipsis:!0},{title:"算法配置信息",dataIndex:"taskAlgos",key:"taskAlgos",width:180},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus",fixed:"right",width:180},{title:"操作",dataIndex:"action",key:"action",fixed:"right"}],A=r({x:"100%",y:document.body.clientHeight-380});return tt(()=>{window.onresize=()=>(()=>{A.value.y=document.body.clientHeight-380})()}),(e,t)=>{const a=st,s=R,S=ut,j=ot,F=Z,G=J;return p(),g("div",dt,[o(K,{searchList:q,data:{taskName:"",taskStatus:null},onChange:L}),x("div",rt,[o(a,{type:"primary",onClick:t[0]||(t[0]=f=>I(null)),style:{padding:"0 15px"}},{default:n(()=>[o(m(lt)),t[2]||(t[2]=d("新建 "))]),_:1})]),o(G,{columns:O,"data-source":m(h),pagination:m(E),loading:m(u),scroll:m(A),onChange:H},{bodyCell:n(({column:f,record:l})=>[f.dataIndex==="taskStatus"?(p(),g("span",mt,[o(s,{color:l.taskStatus?"green":"volcano"},{default:n(()=>[d(C(l.taskStatus?"运行中":"未运行"),1)]),_:2},1032,["color"])])):y("",!0),f.dataIndex==="taskAlgos"?(p(),g("span",ct,C(B(l.taskAlgos)),1)):y("",!0),f.dataIndex==="action"?(p(),g("span",pt,[l.taskStatus?y("",!0):(p(),et(a,{key:0,type:"link",onClick:T=>I(l.mediaId)},{default:n(()=>t[3]||(t[3]=[d("编辑")])),_:2},1032,["onClick"])),o(a,{type:"link",onClick:T=>$(l.mediaId,l.taskStatus)},{default:n(()=>[d(C(l.taskStatus?"关闭":"启动"),1)]),_:2},1032,["onClick"]),o(F,null,{overlay:n(()=>[o(j,null,{default:n(()=>[x("div",kt,[o(S,{title:"是否确定删除该数据?",onConfirm:T=>V(l.mediaId),onCancel:t[1]||(t[1]=()=>{})},{default:n(()=>[o(a,{type:"link"},{default:n(()=>t[4]||(t[4]=[d(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"]),o(a,{type:"link",disabled:""},{default:n(()=>t[5]||(t[5]=[d("配置区域")])),_:1})])]),_:2},1024)]),default:n(()=>[x("a",null,[t[6]||(t[6]=d(" 更多 ")),o(m(it))])]),_:2},1024)])):y("",!0)]),_:1},8,["data-source","pagination","loading","scroll"])])}}},Et=Q(_t,[["__scopeId","data-v-961b82ac"]]);export{Et as default};

import{S as R,T as W}from"./SearchForm-CSBbbiMC.js";import{u as j,D as F,_ as G}from"./index.es--CQYwhSW.js";import{_ as Z,u as J,$ as Q,b as g,d as X,V as Y,o as _,e as f,c as o,f as h,w as s,g as d,h as r,Z as v,U as x,j as i,k as u,i as tt,B as et,a3 as at}from"./index-C75yrSxv.js";import{c as T}from"./channelStore-jj-xI2-r.js";import{P as ot}from"./PlusOutlined-_k0VOsVA.js";import{D as st}from"./index-C_MRxJ4F.js";import{_ as nt}from"./index-D9NDyqdd.js";import"./index-BUFb_l2c.js";import"./Col-DTkjBlJL.js";import"./debounce-CN_rIKSS.js";import"./index-lYwMDmlm.js";import"./index-BujYrMaM.js";import"./List-bYv9SaMX.js";import"./index-CeCNycme.js";const lt={class:"channel-container"},it={class:"add_btn"},rt={key:0},dt={key:1},ut={key:2},pt={class:"option"},ct={__name:"list",setup(mt){const{SEND_MESSAGE:c}=J();Q(T());const{GET_CHANNEL_DATA:D}=T(),S=g([]),N=g(0),M=X(()=>({total:N.value,current:$.value,pageSize:z.value})),k=()=>{const e={type:"getAlgoTaskList"};i.on(e.type,t=>{if(t.result===0||t.msg){const a=t.data.tasks;S.value=a.filter(n=>n.taskDelete!=1)}else u.error("请求失败");i.off(e.type)}),c(e)};let b=[];(()=>{const e={type:"getAiModelList"};i.on(e.type,t=>{t.result===0||t.msg?b=t.data.models:u.error("请求失败"),i.off(e.type)}),c(e)})();const E=e=>e.map(a=>{const n=b.find(y=>y.modelId==a);return n?n.modelName:""}).join("，"),{run:L,loading:p,current:$,pageSize:z}=j(k,{formatResult:e=>e.data.results,pagination:{currentKey:"page",pageSizeKey:"results"}}),C=tt(),I=async(e=null)=>{await D(),setTimeout(()=>{console.log("🚀 ~ handleEdit ~ id:",e),e!=null?C.push({path:"/task/edit",query:{id:e}}):C.push("/task/edit")},0)},B=e=>{const t={type:"delAlgoTaskInfo",mediaId:e,controlCommand:2};i.on(t.type,a=>{a.result===0||a.msg?(u.success("操作成功"),k()):u.error("请求失败"),p.value=!1,i.off(t.type)}),p.value=!0,c(t)},P=(e,t)=>{const a={type:"algoTaskControl",mediaId:e,controlCommand:t?1:0};i.on(a.type,n=>{n.result===0||n.msg?(u.success("操作成功"),k()):u.error("请求失败"),p.value=!1,i.off(a.type)}),p.value=!0,c(a)},U=(e,t,a)=>{console.log("🚀 ~ handleTableChange ~ pag, filters, sorter:",e,t,a),L({results:e.pageSize,page:e==null?void 0:e.current,sortField:a.field,sortOrder:a.order,...t})},V=[{type:"input",key:"keyWord",label:"任务编号"},{type:"select",key:"screenKey",label:"任务状态",list:[{value:"name",label:"分组名称"},{value:"description",label:"描述"}]}],H=[{title:"任务编号",dataIndex:"taskName",key:"taskName",width:180},{title:"视频源",dataIndex:"mediaUrl",key:"mediaUrl",maxWidth:200,ellipsis:!0},{title:"上报地址",dataIndex:"taskPushUrl",key:"taskPushUrl",maxWidth:200,ellipsis:!0},{title:"算法配置信息",dataIndex:"taskAlgos",key:"taskAlgos",width:180},{title:"任务状态",dataIndex:"taskStatus",key:"taskStatus",fixed:"right",width:180},{title:"操作",dataIndex:"action",key:"action",fixed:"right"}],A=g({x:"100%",y:document.body.clientHeight-380});return Y(()=>{window.onresize=()=>(()=>{A.value.y=document.body.clientHeight-380})()}),(e,t)=>{const a=et,n=W,y=nt,q=at,K=F,O=G;return _(),f("div",lt,[o(R,{searchList:V}),h("div",it,[o(a,{type:"primary",onClick:t[0]||(t[0]=m=>I(null)),style:{padding:"0 15px"}},{default:s(()=>[o(d(ot)),t[2]||(t[2]=r("新建 "))]),_:1})]),o(O,{columns:H,"data-source":d(S),pagination:d(M),loading:d(p),scroll:d(A),onChange:U},{bodyCell:s(({column:m,record:l})=>[m.dataIndex==="taskStatus"?(_(),f("span",rt,[o(n,{color:l.taskStatus?"green":"volcano"},{default:s(()=>[r(v(l.taskStatus?"运行中":"未运行"),1)]),_:2},1032,["color"])])):x("",!0),m.dataIndex==="taskAlgos"?(_(),f("span",dt,v(E(l.taskAlgos)),1)):x("",!0),m.dataIndex==="action"?(_(),f("span",ut,[o(a,{type:"link",onClick:w=>I(l.mediaId)},{default:s(()=>t[3]||(t[3]=[r("编辑")])),_:2},1032,["onClick"]),o(a,{type:"link",onClick:w=>P(l.mediaId,l.taskStatus)},{default:s(()=>[r(v(l.taskStatus?"关闭":"启动"),1)]),_:2},1032,["onClick"]),o(K,null,{overlay:s(()=>[o(q,null,{default:s(()=>[h("div",pt,[o(y,{title:"是否确定删除该数据?",onConfirm:w=>B(l.mediaId),onCancel:t[1]||(t[1]=()=>{})},{default:s(()=>[o(a,{type:"link"},{default:s(()=>t[4]||(t[4]=[r(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"]),o(a,{type:"link",disabled:""},{default:s(()=>t[5]||(t[5]=[r("配置区域")])),_:1})])]),_:2},1024)]),default:s(()=>[h("a",null,[t[6]||(t[6]=r(" 更多 ")),o(d(st))])]),_:2},1024)])):x("",!0)]),_:1},8,["data-source","pagination","loading","scroll"])])}}},Dt=Z(ct,[["__scopeId","data-v-be9681b9"]]);export{Dt as default};
